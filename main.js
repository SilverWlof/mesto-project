(()=>{"use strict";var e,t=document.querySelectorAll(".popup"),o=document.querySelector("#popup-profile"),n=document.querySelector("#popup-place"),r=document.querySelector("#popup-zoom"),a=document.querySelector("#popup__updata-avatar"),c=(document.querySelector("#popup__delete-card"),document.forms.ProfileForm),i=(document.forms.CardForm,document.forms.avatarImage,r.querySelector(".popup__zoom-in")),s=r.querySelector(".popup__zoom-description"),u=document.querySelector(".profile"),l=u.querySelector(".profile__name"),d=u.querySelector(".profile__description"),p=u.querySelector(".profile__avatar"),f=a.querySelector("#avatarImage"),m=document.querySelector(".elements");function v(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(o.inactiveButton)):(t.setAttribute("disabled",!0),t.classList.add(o.inactiveButton))}function _(e){e.classList.add("popup_opened"),document.addEventListener("keydown",y)}function h(e){e.target.closest(".popup_opened").classList.remove("popup_opened")}function y(e){"Escape"===e.key&&(document.querySelector(".popup_opened").classList.remove("popup_opened"),document.removeEventListener("keydown",y))}function b(e){var t=function(e){var t=document.querySelector("#element").content.querySelector(".element").cloneNode(!0),o=t.querySelector(".element__text"),n=t.querySelector(".element__image"),a=t.querySelector(".element__button-like"),c=t.querySelector(".element__button-delete"),u=t.querySelector(".element__counter-like");if(t.id=e._id,"ff9b1be57da3d4b8738ed1e8"===e.owner._id?(t.id=e._id,c.addEventListener("click",(function(e){var o;o=t.id,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/"+o,{method:"DELETE",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log("ошибка удаления - "+e)})),e.target.closest(".element").remove()}))):(c.setAttribute("disabled",!0),c.classList.add("element__button-delete_disable")),o.textContent=e.name,n.alt=e.name,n.src=e.link,e.likes){u.textContent=e.likes.length;for(var l=0;l<e.likes.length;l++)"ff9b1be57da3d4b8738ed1e8"===e.likes[l]._id&&a.classList.add("element__button-like_liked")}else u.textContent="0";return n.addEventListener("click",(function(e){i.src=e.target.src,i.alt=e.target.alt,s.textContent=e.target.alt,_(r)})),t}(e);m.prepend(t)}Array.from(document.querySelectorAll(".form")),t.forEach((function(e){e.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&h(e),e.target.classList.contains("popup__button-close")&&h(e)}))})),u.querySelector(".profile__edit-avatar").addEventListener("click",(function(e){_(a)})),a.addEventListener("submit",(function(e){var t,o;e.preventDefault(),o=(t=f).target.querySelector(".popup__button-save"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me/avatar",{method:"PATCH",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({avatar:t.value})}).finally((function(){o.textContent="Сохранение..."})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(){return h(t)})),p.src=f.value,h(e),e.target.reset()})),u.querySelector(".profile__button-edit").addEventListener("click",(function(){_(o),c.name.value=l.textContent,c.description.value=d.textContent})),u.querySelector(".profile__button-add-profile").addEventListener("click",(function(){_(n)})),o.addEventListener("submit",(function(e){var t,o;e.preventDefault(),o=(t=e).target.querySelector(".popup__button-save"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me",{method:"PATCH",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({name:t.target.name.value,about:t.target.description.value})}).finally((function(){o.textContent="Сохранение..."})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(){return h(t)})),l.textContent=c.name.value,d.textContent=c.description.value})),e={formList:"form",inputList:"popup__input",ButtonSave:"popup__button-save",inactiveButton:"popup__button-save_disable",inputError:"error",errorClass:"popup__warning_show"},Array.from(document.querySelectorAll("."+e.formList)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll("."+t.inputList)),n=e.querySelector("."+t.ButtonSave);v(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.valid,t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMassage):t.validity.typeMismatch?t.setCustomValidity(t.dataset.errorMassageUrl):t.validity.tooShort?t.setCustomValidity(t.dataset.errorMassageShort):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=t.querySelector(".".concat(e.id,"-")+o.inputError);e.classList.remove(o.errorClass),n.textContent="",n.classList.remove(o.errorClass)}(t,e,o):function(e,t,o,n){var r=t.querySelector(".".concat(e.id,"-")+n.inputError);e.classList.add(n.errorClass),r.classList.add(n.errorClass),r.textContent=o}(t,e,t.validationMessage,o)}(e,r,t),v(o,n,t)}))}))}(t,e)})),n.addEventListener("submit",(function(e){var t,o,r;e.preventDefault(),o=(t=e).target.querySelector(".popup__button-save"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards",{method:"POST",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({name:t.target.querySelector("#placeName").value,link:t.target.querySelector("#placeImage").value})}).finally((function(){o.textContent="Сохранение..."})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){b(e)})).then((function(){return h(t)})).catch((function(e){console.log("ошибка отпраки - "+e)})),e.target.reset(),(r=n.querySelector(".popup__button-save")).setAttribute("disabled",!0),r.classList.add("popup__button-save_disable")})),m.addEventListener("click",(function(e){var t,o;e.target.classList.contains("element__button-like")&&(event.target.classList.contains("element__button-like_liked")?function(e){var t=e.querySelector(".element__counter-like");fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/likes/"+e.id,{method:"DELETE",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.textContent=e.likes.length}))}(e.target.closest(".element")):(t=e.target.closest(".element"),o=t.querySelector(".element__counter-like"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/likes/"+t.id,{method:"PUT",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){o.textContent=e.likes.length}))),event.target.classList.toggle("element__button-like_liked"))})),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards",{headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(e){return e.json()})).then((function(e){e.reverse().forEach(b)})),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me",{headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(e){return e.json()})).then((function(e){l.textContent=e.name,d.textContent=e.about,p.src=e.avatar}))})();