(()=>{"use strict";var t=document.querySelectorAll(".popup"),e=document.querySelector("#popup-profile"),o=document.querySelector("#popup-place"),n=document.querySelector("#popup-zoom"),r=document.querySelector("#popup__updata-avatar"),a=(document.querySelector("#popup__delete-card"),document.forms.ProfileForm),c=(document.forms.CardForm,document.forms.avatarImage,n.querySelector(".popup__zoom-in")),i=n.querySelector(".popup__zoom-description"),s=document.querySelector(".profile"),u=s.querySelector(".profile__name"),l=s.querySelector(".profile__description"),d=s.querySelector(".profile__avatar"),p=document.querySelector(".elements");function f(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.removeAttribute("disabled"),e.classList.remove(o.inactiveButton)):(e.setAttribute("disabled",!0),e.classList.add(o.inactiveButton))}function m(t){t.classList.add("popup_opened"),document.addEventListener("keydown",_)}function v(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",_)}function _(t){"Escape"===t.key&&(document.querySelector(".popup_opened").classList.remove("popup_opened"),document.removeEventListener("keydown",_))}Array.from(document.querySelectorAll(".form")),t.forEach((function(t){t.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&v(t.target),t.target.classList.contains("popup__button-close")&&v(t.target.closest(".popup_opened"))}))})),s.querySelector(".profile__edit-avatar").addEventListener("click",(function(t){m(r)})),r.addEventListener("submit",(function(t){t.preventDefault(),new Promise((function(e,o){var n,r;e((r=(n=t).target.querySelector(".popup__button-save"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me/avatar",{method:"PATCH",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({avatar:n.target.avatarImage.value})}).finally((function(){r.textContent="Сохранение..."})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log("ошибка - "+t)}))))})).finally((function(){t.target.querySelector(".popup__button-save").textContent="Сохранение..."})).then((function(t){d.src=t.avatar})).then((function(){v(r),t.target.querySelector(".popup__button-save").textContent="Сохранить"})),t.target.reset()})),s.querySelector(".profile__button-edit").addEventListener("click",(function(){m(e),a.name.value=u.textContent,a.description.value=l.textContent})),s.querySelector(".profile__button-add-profile").addEventListener("click",(function(){m(o)})),e.addEventListener("submit",(function(t){t.preventDefault(),new Promise((function(e,o){var n;e((n=t,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me",{method:"PATCH",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({name:n.target.name.value,about:n.target.description.value})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log("ошибка - "+t)}))))})).finally((function(){t.target.querySelector(".popup__button-save").textContent="Сохранение..."})).then((function(t){u.textContent=t.name,l.textContent=t.about})).then((function(){v(e),t.target.querySelector(".popup__button-save").textContent="Сохранить"}))}));var h,y="123";function b(t){var e=function(t){var e=document.querySelector("#element").content.querySelector(".element").cloneNode(!0),o=e.querySelector(".element__text"),r=e.querySelector(".element__image"),a=e.querySelector(".element__button-like"),s=e.querySelector(".element__button-delete"),u=e.querySelector(".element__counter-like");if(e.id=t._id,t.owner._id===y?(e.id=t._id,s.addEventListener("click",(function(t){var o;o=e.id,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/"+o,{method:"DELETE",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log("ошибка удаления - "+t)})),t.target.closest(".element").remove()}))):(s.setAttribute("disabled",!0),s.classList.add("element__button-delete_disable")),o.textContent=t.name,r.alt=t.name,r.src=t.link,t.likes){u.textContent=t.likes.length;for(var l=0;l<t.likes.length;l++)t.likes[l]._id===y&&a.classList.add("element__button-like_liked")}else u.textContent="0";return r.addEventListener("click",(function(t){c.src=t.target.src,c.alt=t.target.alt,i.textContent=t.target.alt,m(n)})),e}(t);p.prepend(e)}new Promise((function(t,e){t(fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me",{headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})))})).then((function(t){u.textContent=t.name,l.textContent=t.about,d.src=t.avatar,y=t._id})).then((function(){fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards",{headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.reverse().forEach(b)}))})),h={formList:"form",inputList:"popup__input",ButtonSave:"popup__button-save",inactiveButton:"popup__button-save_disable",inputError:"error",errorClass:"popup__warning_show"},Array.from(document.querySelectorAll("."+h.formList)).forEach((function(t){!function(t,e){var o=Array.from(t.querySelectorAll("."+e.inputList)),n=t.querySelector("."+e.ButtonSave);f(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.valid,e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMassage):e.validity.typeMismatch?e.setCustomValidity(e.dataset.errorMassageUrl):e.validity.tooShort?e.setCustomValidity(e.dataset.errorMassageShort):e.setCustomValidity(""),e.validity.valid?function(t,e,o){var n=e.querySelector(".".concat(t.id,"-")+o.inputError);t.classList.remove(o.errorClass),n.textContent="",n.classList.remove(o.errorClass)}(e,t,o):function(t,e,o,n){var r=e.querySelector(".".concat(t.id,"-")+n.inputError);t.classList.add(n.errorClass),r.classList.add(n.errorClass),r.textContent=o}(e,t,e.validationMessage,o)}(t,r,e),f(o,n,e)}))}))}(t,h)})),o.addEventListener("submit",(function(t){var e;t.preventDefault(),new Promise((function(e,o){var n;e(((n=t).target.querySelector(".popup__button-save"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards",{method:"POST",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({name:n.target.querySelector("#placeName").value,link:n.target.querySelector("#placeImage").value})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log("ошибка отпраки - "+t)}))))})).finally((function(){t.target.querySelector(".popup__button-save").textContent="Сохранение..."})).then((function(t){b(t)})).then((function(){v(o),t.target.querySelector(".popup__button-save").textContent="Сохранить"})),t.target.reset(),(e=o.querySelector(".popup__button-save")).setAttribute("disabled",!0),e.classList.add("popup__button-save_disable")})),p.addEventListener("click",(function(t){var e,o;t.target.classList.contains("element__button-like")&&(event.target.classList.contains("element__button-like_liked")?function(t){var e=t.querySelector(".element__counter-like");fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/likes/"+t.id,{method:"DELETE",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){e.textContent=t.likes.length}))}(t.target.closest(".element")):(e=t.target.closest(".element"),o=e.querySelector(".element__counter-like"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/likes/"+e.id,{method:"PUT",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){o.textContent=t.likes.length}))),event.target.classList.toggle("element__button-like_liked"))}))})();