(()=>{"use strict";var t=document.querySelectorAll(".popup"),e=document.querySelector("#popup-profile"),o=document.querySelector("#popup-place"),n=document.querySelector("#popup-zoom"),r=document.querySelector("#popup__updata-avatar"),a=(document.querySelector("#popup__delete-card"),document.forms.ProfileForm),c=(document.forms.CardForm,document.forms.avatarImage,document.querySelectorAll(".popup__button-save")),i=n.querySelector(".popup__zoom-in"),s=n.querySelector(".popup__zoom-description"),u=document.querySelector(".profile"),l=u.querySelector(".profile__name"),d=u.querySelector(".profile__description"),p=u.querySelector(".profile__avatar"),f=document.querySelector(".elements");function m(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.removeAttribute("disabled"),e.classList.remove(o.inactiveButton)):(e.setAttribute("disabled",!0),e.classList.add(o.inactiveButton))}function h(t){t.classList.add("popup_opened"),document.addEventListener("keydown",_)}function v(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",_)}function _(t){"Escape"===t.key&&v(document.querySelector(".popup_opened"))}Array.from(document.querySelectorAll(".form")),t.forEach((function(t){t.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&v(t.target),t.target.classList.contains("popup__button-close")&&v(t.target.closest(".popup_opened"))}))}));var y,b="123";function g(t){i.src=t.target.src,i.alt=t.target.alt,s.textContent=t.target.alt,h(n)}function S(t){var e=function(t){var e=document.querySelector("#element").content.querySelector(".element").cloneNode(!0),o=e.querySelector(".element__text"),n=e.querySelector(".element__image"),r=e.querySelector(".element__button-like"),a=e.querySelector(".element__button-delete"),c=e.querySelector(".element__counter-like");if(e.id=t._id,t.owner._id===b?(e.id=t._id,a.addEventListener("click",(function(t){var o;o=e.id,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/"+o,{method:"DELETE",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),t.target.closest(".element").remove()}))):(a.setAttribute("disabled",!0),a.classList.add("element__button-delete_disable")),o.textContent=t.name,n.alt=t.name,n.src=t.link,t.likes){c.textContent=t.likes.length;for(var i=0;i<t.likes.length;i++)t.likes[i]._id===b&&r.classList.add("element__button-like_liked")}else c.textContent="0";return n.addEventListener("click",g),e}(t);f.prepend(e)}fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me",{headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){l.textContent=t.name,d.textContent=t.about,p.src=t.avatar,b=t._id})).then((function(){fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards",{headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.reverse().forEach(S)}))})).catch((function(t){console.log("ошибка - "+t)})),y={formList:"form",inputList:"popup__input",ButtonSave:"popup__button-save",inactiveButton:"popup__button-save_disable",inputError:"error",errorClass:"popup__warning_show"},Array.from(document.querySelectorAll("."+y.formList)).forEach((function(t){!function(t,e){var o=Array.from(t.querySelectorAll("."+e.inputList)),n=t.querySelector("."+e.ButtonSave);m(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.valid,e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMassage):e.validity.typeMismatch?e.setCustomValidity(e.dataset.errorMassageUrl):e.validity.tooShort?e.setCustomValidity(e.dataset.errorMassageShort):e.setCustomValidity(""),e.validity.valid?function(t,e,o){var n=e.querySelector(".".concat(t.id,"-")+o.inputError);t.classList.remove(o.errorClass),n.textContent="",n.classList.remove(o.errorClass)}(e,t,o):function(t,e,o,n){var r=e.querySelector(".".concat(t.id,"-")+n.inputError);t.classList.add(n.errorClass),r.classList.add(n.errorClass),r.textContent=o}(e,t,e.validationMessage,o)}(t,r,e),m(o,n,e)}))}))}(t,y)})),f.addEventListener("click",(function(t){var e;t.target.classList.contains("element__button-like")&&(t.target.classList.contains("element__button-like_liked")?function(t){return fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/likes/"+t.id,{method:"DELETE",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(t.target.closest(".element")).then((function(e){t.target.closest(".element").querySelector(".element__counter-like").textContent=e.likes.length})).then((function(){t.target.classList.toggle("element__button-like_liked")})).catch((function(t){console.log("ошибка - "+t)})):(e=t.target.closest(".element"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards/likes/"+e.id,{method:"PUT",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){t.target.closest(".element").querySelector(".element__counter-like").textContent=e.likes.length})).then((function(){t.target.classList.toggle("element__button-like_liked")})).catch((function(t){console.log("ошибка - "+t)})))})),u.querySelector(".profile__edit-avatar").addEventListener("click",(function(t){h(r)})),u.querySelector(".profile__button-add-profile").addEventListener("click",(function(){h(o)})),u.querySelector(".profile__button-edit").addEventListener("click",(function(){h(e),a.name.value=l.textContent,a.description.value=d.textContent})),r.addEventListener("submit",(function(t){var e,o;t.preventDefault(),c.textContent="Сохранение...",(e=t,o=e.target.querySelector(".popup__button-save"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me/avatar",{method:"PATCH",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({avatar:e.target.avatarImage.value})}).finally((function(){o.textContent="Сохранение..."})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){p.src=t.avatar})).then((function(){v(r),t.target.reset()})).catch((function(t){console.log("ошибка - "+t)})).finally((function(){c.textContent="Сохранить"}))})),e.addEventListener("submit",(function(t){var e;t.preventDefault(),c.textContent="Сохранение...",(e=t,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/users/me",{method:"PATCH",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({name:e.target.name.value,about:e.target.description.value})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){l.textContent=t.name,d.textContent=t.about})).catch((function(t){console.log("ошибка - "+t)})).finally((function(){c.textContent="Сохранить"}))})),o.addEventListener("submit",(function(t){var e;t.preventDefault(),c.textContent="Сохранение...",(e=t,e.target.querySelector(".popup__button-save"),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards",{method:"POST",headers:{authorization:"6ad1c47f-6af4-42c4-b56f-bacd15588390","Content-Type":"application/json"},body:JSON.stringify({name:e.target.querySelector("#placeName").value,link:e.target.querySelector("#placeImage").value})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){S(t)})).then((function(){var e;v(o),t.target.reset(),(e=o.querySelector(".popup__button-save")).setAttribute("disabled",!0),e.classList.add("popup__button-save_disable")})).catch((function(t){console.log("ошибка - "+t)})).finally((function(){c.textContent="Сохранить"}))}))})();